WarDuchyEffect = {
    save_scope_as = war_attacker
	faith = {
		great_holy_war = {
			random_pledged_attacker = {
				limit = {
					exists = ghw_beneficiary
					this = scope:war_attacker
				}
				ghw_beneficiary = {
					save_scope_as = beneficiary
				}
			}
			ghw_war = {
				primary_defender = {
					random_sub_realm_county = {
						limit = {
							duchy = {
								any_in_de_jure_hierarchy = {
									count = all
									trigger_if = {
										limit = { tier = tier_county }
										holder.top_liege = scope:defender
										NOT  = { county_controller = holder }
										exists = var:occupant
										var:occupant = scope:war_attacker
									}
								}
							}
						}
						duchy = {
							every_in_de_jure_hierarchy = {
								limit = { tier = tier_county }
								scope:beneficiary = {
									add_to_variable_list = {
										name = counties_transferred
										target = prev
									}
								}
							}
						}
					}
				}
			}
		}
	}
	scope:beneficiary = { 
		save_scope_as = founder
		random_in_list = {
			variable = counties_transferred
			save_scope_as = old_title
		}

		create_dynamic_title = {
			tier = kingdom
			name = "[old_title.GetNameNoTooltip]"
		}
		
		create_title_and_vassal_change = {
			type = conquest_holy_war
			save_scope_as = change
			add_claim_on_loss = no
		}

		every_in_list = {
			variable = counties_transferred
			change_title_holder = {
				holder = PREV
				change = scope:change
			}
		}

		resolve_title_and_vassal_change = scope:change

		create_title_and_vassal_change = {
			type = created
			save_scope_as = change
			add_claim_on_loss = no
		}

		scope:new_title = {
			set_coa = scope:old_title
			set_color_from_title = scope:war_attacker.primary_title
			change_title_holder = {
				holder = PREV
				change = scope:change
			}
		}

		resolve_title_and_vassal_change = scope:change
		
		if = {
			limit = { is_independent_ruler = no }
			create_title_and_vassal_change = {
				type = created
				save_scope_as = change
				add_claim_on_loss = no
			}
	
			becomes_independent = {
				change = scope:change
			}
			
			resolve_title_and_vassal_change = scope:change
		}
	}
}
